<div class="card mb-8! h-full">
  <span class="text-muted-color font-medium mb-2 text-md md:text-lg">Totais anual por categoria</span>
  <div class="w-full flex flex-col md:flex-row justify-between mt-4 mb-10 items-end">
    <div class="flex flex-row gap-4">
      <div class="flex flex-col gap-1 w-full md:w-32">
        <label class="block text-md font-bold text-muted-foreground">Ano</label>
        <p-select
          [(ngModel)]="monthlyTotalsByYearViewModel.selectedYear"
          [options]="monthlyTotalsByYearViewModel.availableYears"
          (onChange)="monthlyTotalsByYearViewModel.getMonthlyCategories()"
          class="w-full" />
      </div>

      <div class="flex flex-col gap-1 w-full md:w-48">
        <label class="block text-md font-bold text-muted-foreground">Tipo</label>
        <p-select
          [(ngModel)]="monthlyTotalsByYearViewModel.selectedType"
          [options]="financeTypes"
          optionLabel="label"
          optionValue="value"
          (onChange)="monthlyTotalsByYearViewModel.getMonthlyCategories()"
          class="w-full" />
      </div>
    </div>

    <p-button
      (onClick)="monthlyTotalsByYearViewModel.exportMonthlyTotalCategoriesToExcel()"
      class="self-end"
      label="Exportar"
      icon="pi pi-download"
      severity="success" />
  </div>

  <div class="shadow-lg rounded-lg overflow-hidden">
    <p-table
      [value]="monthlyTotalCategories()"
      [scrollable]="true"
      scrollHeight="600px"
      [tableStyle]="{ 'min-width': '60rem' }"
      class="p-datatable-sm p-datatable-striped">
      <ng-template pTemplate="header">
        <tr class="bg-muted/50 border-b border-border">
          <th pFrozenColumn class="px-4 py-3 text-left font-semibold text-foreground bg-muted!">Categoria</th>

          @for (month of monthlyTotalsByYearViewModel.months; track month) {
            <th class="px-2 py-3 text-center font-medium text-muted-foreground uppercase tracking-wider">
              {{ month }}
            </th>
          }

          <th class="px-4 py-3 text-right font-semibold text-foreground bg-muted!">Total Anual</th>
        </tr>
      </ng-template>

      <ng-template pTemplate="body" let-row>
        <tr class="hover:bg-accent/50 transition-colors border-b border-border/40">
          <td pFrozenColumn class="px-4 py-3 font-medium text-foreground border-r border-border/50 bg-card!">
            <div class="flex items-center gap-2">
              <span [class]="row.type === 'C' ? 'text-green-500' : 'text-red-500'"> ‚óè </span>
              {{ row.name }}
            </div>
          </td>

          @for (value of row.months; track $index) {
            <td class="px-2 py-3 text-center whitespace-nowrap tabular-nums text-foreground">
              <span [class.opacity-20]="value === 0">
                {{ value === 0 ? '-' : (value | currency: 'BRL' : 'symbol' : '1.0-2') }}
              </span>
            </td>
          }

          <td class="px-4 py-3 text-right font-bold text-foreground bg-muted/30 tabular-nums">
            {{ row.totalYear | currency: 'BRL' }}
          </td>
        </tr>
      </ng-template>

      <ng-template pTemplate="emptymessage">
        <tr class="bg-card">
          <td [attr.colspan]="monthlyTotalsByYearViewModel.months.length + 2" class="p-8 text-center text-muted-foreground">
            Nenhum dado encontrado para o filtro selecionado.
          </td>
        </tr>
      </ng-template>
    </p-table>
  </div>
</div>
