<div class="my-4 flex flex-wrap justify-center md:justify-end gap-2">
  <p-button class="self-end" label="Novo" icon="pi pi-plus" severity="primary" (onClick)="openAddInvestment()" />
</div>

<p-table
  #dt
  [rows]="20"
  [value]="financeInvestmentsViewModel.financeInvestments()"
  [paginator]="true"
  [globalFilterFields]="globalFilterFields"
  [tableStyle]="{ 'min-width': '75rem' }"
  [(selection)]="selectedInvestment"
  selectionMode="single"
  [metaKeySelection]="false"
  dataKey="id"
  [scrollable]="true"
  [rowHover]="true"
  currentPageReportTemplate="Exibindo {first} a {last} de {totalRecords} investimentos"
  [showCurrentPageReport]="true"
  [rowsPerPageOptions]="[20, 30, 50, 100, 200]">
  <ng-template #header>
    <tr>
      <th pSortableColumn="users.full_name" style="min-width: 8rem">
        Tesoureiro
        <p-sortIcon field="users.full_name" />
      </th>
      <th style="min-width: 4rem">Valor (R$)</th>
      <th style="min-width: 8rem">Motivo</th>
      <th style="min-width: 8rem">Conta Bancária</th>
      <th style="min-width: 8rem">Mês/Ano</th>
      <th style="min-width: 8rem">Data</th>
      <th style="min-width: 6rem"></th>
    </tr>
  </ng-template>
  <ng-template #body let-investment>
    <tr>
      <td style="min-width: 8rem">{{ investment.users?.full_name | firstAndLastname }}</td>
      <td style="min-width: 4rem">{{ investment.value }}</td>
      <td style="min-width: 8rem">{{ investment.reason }}</td>
      <td style="min-width: 8rem">{{ investment.account_bank }}</td>
      <td style="min-width: 8rem">{{ investment.month }}</td>
      <td>{{ investment.created_at | date }}</td>
      <td>
        <p-button icon="pi pi-pencil" severity="info" [rounded]="true" [text]="true" (click)="openEditInvestment(investment)" />
      </td>
    </tr>
  </ng-template>
</p-table>

<p-dialog
  [(visible)]="actionDialog"
  [header]="modalTitle()"
  [modal]="true"
  [breakpoints]="{ '700px': '40vw', '600px': '50vw', '575px': '80vw', '450px': '90vw', '300px': '98vw' }"
  [style]="{ width: '40vw' }"
  (onHide)="hideDialog()"
  [draggable]="true"
  [resizable]="false"
  [maximizable]="true">
  <ng-template #content>
    <p-toast />
    @if (mode() === 'add') {
      <div
        class="mb-4 rounded-lg border border-blue-200 dark:border-blue-800 bg-linear-to-r from-blue-50 to-indigo-50 dark:from-blue-950 dark:to-indigo-950 p-4 shadow-sm">
        <div class="flex items-center gap-3">
          <div class="flex h-10 w-10 items-center justify-center rounded-full bg-blue-100 dark:bg-blue-900">
            <i class="pi pi-wallet text-blue-600 dark:text-blue-400 text-lg"></i>
          </div>
          <div>
            <span class="block text-sm text-gray-500 dark:text-gray-400 font-medium">Saldo total disponível para investir</span>
            <span class="block text-xl font-bold text-blue-700 dark:text-blue-300">
              R$ {{ financeReportsViewModel.getCurrentMonthTotalBalance()?.toFixed(2) }}
            </span>
          </div>
        </div>
      </div>
    }

    <form [formGroup]="investmentForm">
      <div class="flex flex-wrap flex-col gap-4">
        <div class="my-2">
          <label for="value" class="block font-bold mb-3">Valor</label>
          <p-inputnumber
            formControlName="value"
            inputId="value"
            mode="decimal"
            [minFractionDigits]="2"
            [maxFractionDigits]="4"
            required />
          <app-custom-validation-message id="valueErrorMessage" controlName="value" />
        </div>
        <div class="my-2">
          <label for="reason" class="block font-bold mb-3">Motivo</label>
          <input pInputText class="w-full" type="text" formControlName="reason" id="reason" name="reason" required />
        </div>
        <div class="my-2">
          <label for="account_bank" class="block font-bold mb-3">Conta de envio</label>
          <p-select
            formControlName="account_bank"
            [options]="bankTypes"
            optionLabel="label"
            optionValue="value"
            class="w-full"
            required />
        </div>
      </div>
    </form>
    @if (mode() === 'add') {
      <p-message class="my-2" severity="error" icon="pi pi-info-circle"
        >Faça a transferência bancária antes de adicionar o investimento. Confirme o valor!</p-message
      >
    } @else if (mode() === 'edit') {
      <p-message class="my-2" severity="info" icon="pi pi-info-circle"
        >Edite apenas em caso de retorno do investimento para atualização do total na igreja!</p-message
      >
    }
  </ng-template>

  <ng-template #footer>
    <p-button label="Cancelar" icon="pi pi-times" text (onClick)="hideDialog()"></p-button>
    <p-button
      [disabled]="investmentForm.invalid"
      label="Salvar"
      icon="pi pi-check"
      (onClick)="creatOrEditInvestment()"></p-button>
  </ng-template>
</p-dialog>

<p-confirmdialog [style]="{ width: '450px' }"></p-confirmdialog>
